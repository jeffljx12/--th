m=100
sigma <- diag(m)+matrix(rep(rho,m*m),nrow=m)-diag(rep(rho,m))
df <- data.frame(mvrnorm(n = 200, mu=c(rep(0.5,0.1*m),rep(0,0.9*m)), sigma))
mul.z <- apply(df,2,z.test)
n.reject <- sum(mul.z >= qnorm(0.95))
n.reject <-max(n.reject,1)
n.f_reject <- sum(mul.z[(0.1*m+1):m]>=qnorm(0.95))
fdr <- n.f_reject/n.reject
fdr
rho=0.9
m=100
sigma <- diag(m)+matrix(rep(rho,m*m),nrow=m)-diag(rep(rho,m))
df <- data.frame(mvrnorm(n = 200, mu=c(rep(0.5,0.1*m),rep(0,0.9*m)), sigma))
mul.z <- apply(df,2,z.test)
n.reject <- sum(mul.z >= qnorm(0.95))
n.reject <-max(n.reject,1)
n.f_reject <- sum(mul.z[(0.1*m+1):m]>=qnorm(0.95))
fdr <- n.f_reject/n.reject
fdr
rho=0.9
m=100
sigma <- diag(m)+matrix(rep(rho,m*m),nrow=m)-diag(rep(rho,m))
df <- data.frame(mvrnorm(n = 200, mu=c(rep(0.5,0.1*m),rep(0,0.9*m)), sigma))
mul.z <- apply(df,2,z.test)
n.reject <- sum(mul.z >= qnorm(0.95))
n.reject <-max(n.reject,1)
n.f_reject <- sum(mul.z[(0.1*m+1):m]>=qnorm(0.95))
fdr <- n.f_reject/n.reject
fdr
rho=0.9
m=100
sigma <- diag(m)+matrix(rep(rho,m*m),nrow=m)-diag(rep(rho,m))
df <- data.frame(mvrnorm(n = 200, mu=c(rep(0.5,0.1*m),rep(0,0.9*m)), sigma))
mul.z <- apply(df,2,z.test)
n.reject <- sum(mul.z >= qnorm(0.95))
n.reject <-max(n.reject,1)
n.f_reject <- sum(mul.z[(0.1*m+1):m]>=qnorm(0.95))
fdr <- n.f_reject/n.reject
fdr
rho=0.5
m=100
sigma <- diag(m)+matrix(rep(rho,m*m),nrow=m)-diag(rep(rho,m))
df <- data.frame(mvrnorm(n = 200, mu=c(rep(0.5,0.1*m),rep(0,0.9*m)), sigma))
mul.z <- apply(df,2,z.test)
n.reject <- sum(mul.z >= qnorm(0.95))
n.reject <-max(n.reject,1)
n.f_reject <- sum(mul.z[(0.1*m+1):m]>=qnorm(0.95))
fdr <- n.f_reject/n.reject
fdr
rho=0.5
m=100
sigma <- diag(m)+matrix(rep(rho,m*m),nrow=m)-diag(rep(rho,m))
df <- data.frame(mvrnorm(n = 200, mu=c(rep(0.5,0.1*m),rep(0,0.9*m)), sigma))
mul.z <- apply(df,2,z.test)
n.reject <- sum(mul.z >= qnorm(0.95))
n.reject <-max(n.reject,1)
n.f_reject <- sum(mul.z[(0.1*m+1):m]>=qnorm(0.95))
fdr <- n.f_reject/n.reject
fdr
rho=0.5
m=100
sigma <- diag(m)+matrix(rep(rho,m*m),nrow=m)-diag(rep(rho,m))
df <- data.frame(mvrnorm(n = 200, mu=c(rep(0.5,0.1*m),rep(0,0.9*m)), sigma))
mul.z <- apply(df,2,z.test)
n.reject <- sum(mul.z >= qnorm(0.95))
n.reject <-max(n.reject,1)
n.f_reject <- sum(mul.z[(0.1*m+1):m]>=qnorm(0.95))
fdr <- n.f_reject/n.reject
fdr
rho=0.5
m=100
sigma <- diag(m)+matrix(rep(rho,m*m),nrow=m)-diag(rep(rho,m))
df <- data.frame(mvrnorm(n = 200, mu=c(rep(0.5,0.1*m),rep(0,0.9*m)), sigma))
mul.z <- apply(df,2,z.test)
n.reject <- sum(mul.z >= qnorm(0.95))
n.reject <-max(n.reject,1)
n.f_reject <- sum(mul.z[(0.1*m+1):m]>=qnorm(0.95))
fdr <- n.f_reject/n.reject
fdr
rho=0.5
m=100
sigma <- diag(m)+matrix(rep(rho,m*m),nrow=m)-diag(rep(rho,m))
df <- data.frame(mvrnorm(n = 200, mu=c(rep(0.5,0.1*m),rep(0,0.9*m)), sigma))
mul.z <- apply(df,2,z.test)
n.reject <- sum(mul.z >= qnorm(0.95))
n.reject <-max(n.reject,1)
n.f_reject <- sum(mul.z[(0.1*m+1):m]>=qnorm(0.95))
fdr <- n.f_reject/n.reject
fdr
rho=0.5
m=100
sigma <- diag(m)+matrix(rep(rho,m*m),nrow=m)-diag(rep(rho,m))
df <- data.frame(mvrnorm(n = 200, mu=c(rep(0.5,0.1*m),rep(0,0.9*m)), sigma))
mul.z <- apply(df,2,z.test)
n.reject <- sum(mul.z >= qnorm(0.95))
n.reject <-max(n.reject,1)
n.f_reject <- sum(mul.z[(0.1*m+1):m]>=qnorm(0.95))
fdr <- n.f_reject/n.reject
fdr
rho=0.5
m=100
sigma <- diag(m)+matrix(rep(rho,m*m),nrow=m)-diag(rep(rho,m))
df <- data.frame(mvrnorm(n = 200, mu=c(rep(0.5,0.1*m),rep(0,0.9*m)), sigma))
mul.z <- apply(df,2,z.test)
n.reject <- sum(mul.z >= qnorm(0.95))
n.reject <-max(n.reject,1)
n.f_reject <- sum(mul.z[(0.1*m+1):m]>=qnorm(0.95))
fdr <- n.f_reject/n.reject
fdr
rho=0.5
m=100
sigma <- diag(m)+matrix(rep(rho,m*m),nrow=m)-diag(rep(rho,m))
df <- data.frame(mvrnorm(n = 200, mu=c(rep(0.5,0.1*m),rep(0,0.9*m)), sigma))
mul.z <- apply(df,2,z.test)
n.reject <- sum(mul.z >= qnorm(0.95))
n.reject <-max(n.reject,1)
n.f_reject <- sum(mul.z[(0.1*m+1):m]>=qnorm(0.95))
fdr <- n.f_reject/n.reject
fdr
rho=0.5
m=100
sigma <- diag(m)+matrix(rep(rho,m*m),nrow=m)-diag(rep(rho,m))
df <- data.frame(mvrnorm(n = 200, mu=c(rep(0.5,0.1*m),rep(0,0.9*m)), sigma))
mul.z <- apply(df,2,z.test)
n.reject <- sum(mul.z >= qnorm(0.95))
n.reject <-max(n.reject,1)
n.f_reject <- sum(mul.z[(0.1*m+1):m]>=qnorm(0.95))
fdr <- n.f_reject/n.reject
fdr
rho=0.5
m=100
sigma <- diag(m)+matrix(rep(rho,m*m),nrow=m)-diag(rep(rho,m))
df <- data.frame(mvrnorm(n = 200, mu=c(rep(0.5,0.1*m),rep(0,0.9*m)), sigma))
mul.z <- apply(df,2,z.test)
n.reject <- sum(mul.z >= qnorm(0.95))
n.reject <-max(n.reject,1)
n.f_reject <- sum(mul.z[(0.1*m+1):m]>=qnorm(0.95))
fdr <- n.f_reject/n.reject
fdr
rho=0.5
m=100
sigma <- diag(m)+matrix(rep(rho,m*m),nrow=m)-diag(rep(rho,m))
df <- data.frame(mvrnorm(n = 200, mu=c(rep(0.5,0.1*m),rep(0,0.9*m)), sigma))
mul.z <- apply(df,2,z.test)
n.reject <- sum(mul.z >= qnorm(0.95))
n.reject <-max(n.reject,1)
n.f_reject <- sum(mul.z[(0.1*m+1):m]>=qnorm(0.95))
fdr <- n.f_reject/n.reject
fdr
rho=0.5
m=100
sigma <- diag(m)+matrix(rep(rho,m*m),nrow=m)-diag(rep(rho,m))
df <- data.frame(mvrnorm(n = 200, mu=c(rep(0.5,0.1*m),rep(0,0.9*m)), sigma))
mul.z <- apply(df,2,z.test)
n.reject <- sum(mul.z >= qnorm(0.95))
n.reject <-max(n.reject,1)
n.f_reject <- sum(mul.z[(0.1*m+1):m]>=qnorm(0.95))
fdr <- n.f_reject/n.reject
fdr
rho=0.5
m=100
sigma <- diag(m)+matrix(rep(rho,m*m),nrow=m)-diag(rep(rho,m))
df <- data.frame(mvrnorm(n = 200, mu=c(rep(0.5,0.1*m),rep(0,0.9*m)), sigma))
mul.z <- apply(df,2,z.test)
n.reject <- sum(mul.z >= qnorm(0.95))
n.reject <-max(n.reject,1)
n.f_reject <- sum(mul.z[(0.1*m+1):m]>=qnorm(0.95))
fdr <- n.f_reject/n.reject
fdr
rho=0.1
m=100
sigma <- diag(m)+matrix(rep(rho,m*m),nrow=m)-diag(rep(rho,m))
df <- data.frame(mvrnorm(n = 200, mu=c(rep(0.5,0.1*m),rep(0,0.9*m)), sigma))
mul.z <- apply(df,2,z.test)
n.reject <- sum(mul.z >= qnorm(0.95))
n.reject <-max(n.reject,1)
n.f_reject <- sum(mul.z[(0.1*m+1):m]>=qnorm(0.95))
fdr <- n.f_reject/n.reject
fdr
rho=0.1
m=100
sigma <- diag(m)+matrix(rep(rho,m*m),nrow=m)-diag(rep(rho,m))
df <- data.frame(mvrnorm(n = 200, mu=c(rep(0.5,0.1*m),rep(0,0.9*m)), sigma))
mul.z <- apply(df,2,z.test)
n.reject <- sum(mul.z >= qnorm(0.95))
n.reject <-max(n.reject,1)
n.f_reject <- sum(mul.z[(0.1*m+1):m]>=qnorm(0.95))
fdr <- n.f_reject/n.reject
fdr
rho=0.1
m=100
sigma <- diag(m)+matrix(rep(rho,m*m),nrow=m)-diag(rep(rho,m))
df <- data.frame(mvrnorm(n = 200, mu=c(rep(0.5,0.1*m),rep(0,0.9*m)), sigma))
mul.z <- apply(df,2,z.test)
n.reject <- sum(mul.z >= qnorm(0.95))
n.reject <-max(n.reject,1)
n.f_reject <- sum(mul.z[(0.1*m+1):m]>=qnorm(0.95))
fdr <- n.f_reject/n.reject
fdr
rho=0.1
m=100
sigma <- diag(m)+matrix(rep(rho,m*m),nrow=m)-diag(rep(rho,m))
df <- data.frame(mvrnorm(n = 200, mu=c(rep(0.5,0.1*m),rep(0,0.9*m)), sigma))
mul.z <- apply(df,2,z.test)
n.reject <- sum(mul.z >= qnorm(0.95))
n.reject <-max(n.reject,1)
n.f_reject <- sum(mul.z[(0.1*m+1):m]>=qnorm(0.95))
fdr <- n.f_reject/n.reject
fdr
rho=0.1
m=100
sigma <- diag(m)+matrix(rep(rho,m*m),nrow=m)-diag(rep(rho,m))
df <- data.frame(mvrnorm(n = 200, mu=c(rep(0.5,0.1*m),rep(0,0.9*m)), sigma))
mul.z <- apply(df,2,z.test)
n.reject <- sum(mul.z >= qnorm(0.95))
n.reject <-max(n.reject,1)
n.f_reject <- sum(mul.z[(0.1*m+1):m]>=qnorm(0.95))
fdr <- n.f_reject/n.reject
fdr
rho=0.1
m=100
sigma <- diag(m)+matrix(rep(rho,m*m),nrow=m)-diag(rep(rho,m))
df <- data.frame(mvrnorm(n = 200, mu=c(rep(0.5,0.1*m),rep(0,0.9*m)), sigma))
mul.z <- apply(df,2,z.test)
n.reject <- sum(mul.z >= qnorm(0.95))
n.reject <-max(n.reject,1)
n.f_reject <- sum(mul.z[(0.1*m+1):m]>=qnorm(0.95))
fdr <- n.f_reject/n.reject
fdr
rho=0.1
m=100
sigma <- diag(m)+matrix(rep(rho,m*m),nrow=m)-diag(rep(rho,m))
df <- data.frame(mvrnorm(n = 200, mu=c(rep(0.5,0.1*m),rep(0,0.9*m)), sigma))
mul.z <- apply(df,2,z.test)
n.reject <- sum(mul.z >= qnorm(0.95))
n.reject <-max(n.reject,1)
n.f_reject <- sum(mul.z[(0.1*m+1):m]>=qnorm(0.95))
fdr <- n.f_reject/n.reject
fdr
rho=0.1
m=100
sigma <- diag(m)+matrix(rep(rho,m*m),nrow=m)-diag(rep(rho,m))
df <- data.frame(mvrnorm(n = 200, mu=c(rep(0.5,0.1*m),rep(0,0.9*m)), sigma))
mul.z <- apply(df,2,z.test)
n.reject <- sum(mul.z >= qnorm(0.95))
n.reject <-max(n.reject,1)
n.f_reject <- sum(mul.z[(0.1*m+1):m]>=qnorm(0.95))
fdr <- n.f_reject/n.reject
fdr
rho=0.1
m=100
sigma <- diag(m)+matrix(rep(rho,m*m),nrow=m)-diag(rep(rho,m))
df <- data.frame(mvrnorm(n = 200, mu=c(rep(0.5,0.1*m),rep(0,0.9*m)), sigma))
mul.z <- apply(df,2,z.test)
n.reject <- sum(mul.z >= qnorm(0.95))
n.reject <-max(n.reject,1)
n.f_reject <- sum(mul.z[(0.1*m+1):m]>=qnorm(0.95))
fdr <- n.f_reject/n.reject
fdr
rho=0.1
m=100
sigma <- diag(m)+matrix(rep(rho,m*m),nrow=m)-diag(rep(rho,m))
df <- data.frame(mvrnorm(n = 200, mu=c(rep(0.5,0.1*m),rep(0,0.9*m)), sigma))
mul.z <- apply(df,2,z.test)
n.reject <- sum(mul.z >= qnorm(0.95))
n.reject <-max(n.reject,1)
n.f_reject <- sum(mul.z[(0.1*m+1):m]>=qnorm(0.95))
fdr <- n.f_reject/n.reject
fdr
rho=0.1
m=100
sigma <- diag(m)+matrix(rep(rho,m*m),nrow=m)-diag(rep(rho,m))
df <- data.frame(mvrnorm(n = 200, mu=c(rep(0.5,0.1*m),rep(0,0.9*m)), sigma))
mul.z <- apply(df,2,z.test)
n.reject <- sum(mul.z >= qnorm(0.95))
n.reject <-max(n.reject,1)
n.f_reject <- sum(mul.z[(0.1*m+1):m]>=qnorm(0.95))
fdr <- n.f_reject/n.reject
fdr
rho=0.1
m=100
sigma <- diag(m)+matrix(rep(rho,m*m),nrow=m)-diag(rep(rho,m))
df <- data.frame(mvrnorm(n = 200, mu=c(rep(0.5,0.1*m),rep(0,0.9*m)), sigma))
mul.z <- apply(df,2,z.test)
n.reject <- sum(mul.z >= qnorm(0.95))
n.reject <-max(n.reject,1)
n.f_reject <- sum(mul.z[(0.1*m+1):m]>=qnorm(0.95))
fdr <- n.f_reject/n.reject
fdr
rho=0
m=100
sigma <- diag(m)+matrix(rep(rho,m*m),nrow=m)-diag(rep(rho,m))
df <- data.frame(mvrnorm(n = 200, mu=c(rep(0.5,0.1*m),rep(0,0.9*m)), sigma))
mul.z <- apply(df,2,z.test)
n.reject <- sum(mul.z >= qnorm(0.95))
n.reject <-max(n.reject,1)
n.f_reject <- sum(mul.z[(0.1*m+1):m]>=qnorm(0.95))
fdr <- n.f_reject/n.reject
fdr
rho=0
m=100
sigma <- diag(m)+matrix(rep(rho,m*m),nrow=m)-diag(rep(rho,m))
df <- data.frame(mvrnorm(n = 200, mu=c(rep(0.5,0.1*m),rep(0,0.9*m)), sigma))
mul.z <- apply(df,2,z.test)
n.reject <- sum(mul.z >= qnorm(0.95))
n.reject <-max(n.reject,1)
n.f_reject <- sum(mul.z[(0.1*m+1):m]>=qnorm(0.95))
fdr <- n.f_reject/n.reject
fdr
rho=0
m=100
sigma <- diag(m)+matrix(rep(rho,m*m),nrow=m)-diag(rep(rho,m))
df <- data.frame(mvrnorm(n = 200, mu=c(rep(0.5,0.1*m),rep(0,0.9*m)), sigma))
mul.z <- apply(df,2,z.test)
n.reject <- sum(mul.z >= qnorm(0.95))
n.reject <-max(n.reject,1)
n.f_reject <- sum(mul.z[(0.1*m+1):m]>=qnorm(0.95))
fdr <- n.f_reject/n.reject
fdr
rho=0
m=100
sigma <- diag(m)+matrix(rep(rho,m*m),nrow=m)-diag(rep(rho,m))
df <- data.frame(mvrnorm(n = 200, mu=c(rep(0.5,0.1*m),rep(0,0.9*m)), sigma))
mul.z <- apply(df,2,z.test)
n.reject <- sum(mul.z >= qnorm(0.95))
n.reject <-max(n.reject,1)
n.f_reject <- sum(mul.z[(0.1*m+1):m]>=qnorm(0.95))
fdr <- n.f_reject/n.reject
fdr
rho=0
m=100
sigma <- diag(m)+matrix(rep(rho,m*m),nrow=m)-diag(rep(rho,m))
df <- data.frame(mvrnorm(n = 200, mu=c(rep(0.5,0.1*m),rep(0,0.9*m)), sigma))
mul.z <- apply(df,2,z.test)
n.reject <- sum(mul.z >= qnorm(0.95))
n.reject <-max(n.reject,1)
n.f_reject <- sum(mul.z[(0.1*m+1):m]>=qnorm(0.95))
fdr <- n.f_reject/n.reject
fdr
rho=0
m=100
sigma <- diag(m)+matrix(rep(rho,m*m),nrow=m)-diag(rep(rho,m))
df <- data.frame(mvrnorm(n = 200, mu=c(rep(0.5,0.1*m),rep(0,0.9*m)), sigma))
mul.z <- apply(df,2,z.test)
n.reject <- sum(mul.z >= qnorm(0.95))
n.reject <-max(n.reject,1)
n.f_reject <- sum(mul.z[(0.1*m+1):m]>=qnorm(0.95))
fdr <- n.f_reject/n.reject
fdr
rho=0
m=100
sigma <- diag(m)+matrix(rep(rho,m*m),nrow=m)-diag(rep(rho,m))
df <- data.frame(mvrnorm(n = 200, mu=c(rep(0.5,0.1*m),rep(0,0.9*m)), sigma))
mul.z <- apply(df,2,z.test)
n.reject <- sum(mul.z >= qnorm(0.95))
n.reject <-max(n.reject,1)
n.f_reject <- sum(mul.z[(0.1*m+1):m]>=qnorm(0.95))
fdr <- n.f_reject/n.reject
fdr
rho=0
m=100
sigma <- diag(m)+matrix(rep(rho,m*m),nrow=m)-diag(rep(rho,m))
df <- data.frame(mvrnorm(n = 200, mu=c(rep(0.5,0.1*m),rep(0,0.9*m)), sigma))
mul.z <- apply(df,2,z.test)
n.reject <- sum(mul.z >= qnorm(0.95))
n.reject <-max(n.reject,1)
n.f_reject <- sum(mul.z[(0.1*m+1):m]>=qnorm(0.95))
fdr <- n.f_reject/n.reject
fdr
rho=0
m=100
sigma <- diag(m)+matrix(rep(rho,m*m),nrow=m)-diag(rep(rho,m))
df <- data.frame(mvrnorm(n = 200, mu=c(rep(0.5,0.1*m),rep(0,0.9*m)), sigma))
mul.z <- apply(df,2,z.test)
n.reject <- sum(mul.z >= qnorm(0.95))
n.reject <-max(n.reject,1)
n.f_reject <- sum(mul.z[(0.1*m+1):m]>=qnorm(0.95))
fdr <- n.f_reject/n.reject
fdr
rep(0.5,0.1*m)
rep(0,0.9*m)
sigma
rho=0.5
m=100
sigma <- diag(m)+matrix(rep(rho,m*m),nrow=m)-diag(rep(rho,m))
sigma
eVeR_m <- function(rho,m,B,stat){
# number of total rejection
n.f_reject <- c()
# number of false rejection
# create correlation mareix with equal correlation
sigma <- diag(m)+matrix(rep(rho,m*m),nrow=m)-diag(rep(rho,m))
# Simulation start
for (i in 1:B) {
# create multivariate normal observations
df <- data.frame(mvrnorm(n = 200, mu=c(rep(0.5,0.1*m),rep(0,0.9*m)), sigma))
# calculate z stats
mul.z <- apply(df,2,z.test)
# number of rejections
n.reject <- sum(mul.z>=qnorm(0.95))
n.reject <-max(n.reject,1)
n.f_reject <- sum(mul.z[(0.1*m+1):m]>=qnorm(0.95))
#fdr <- n.f_reject/n.reject
}
# calculate empirical mean/var of # rejections
mean.eVeR <- mean(n.f_reject)/mean(n.reject)
var.eVeR <- var(n.f_reject)/var(n.reject)
if (stat=='mean'){
return(mean.eVeR)
} else if (stat=='var'){
return(var.eVeR)
}
}
#  mean
rho.list <- seq(0,1,by=0.05)
error.mean_m  <- sapply(rho.list, eVeR_m, m=100, B=5000,stat='mean')
plot(error.mean_m ~rho.list, xlab='Correlation', ylab='E(v)/E(R) (mean)' )
library(shiny)
library(MASS)
library(mvtnorm)
ui <- fluidPage(theme = shinytheme("lumen"),
titlePanel("Distributions of pooled z values under different correlation"),
sidebarLayout(
sidebarPanel(
# select number of variables m
sliderInput("m",
"number of variables",
min = 10, max = 1000,
value = 100,
step = 10),
# select number of obs n
sliderInput("n",
"number of obervations",
min = 10, max = 500,
value = 200,
step = 10),
# select corrletaion
sliderInput("rho",
"pair wise correlation",
min = 0, max = 1,
value = 0.5,
step = 0.05)
),
# Output: histogram of pooled z
mainPanel(
plotOutput(outputId = "dist.z", height = "300px")
# textOutput(outputId = "desc")
)
)
)
server <- function(input, output) {
# Subset data
df <- reactive({
m <- input$m
n <- input$n
rho <- input$rho
sigma <- diag(m)+matrix(rep(rho,m*m),nrow=m)-diag(rep(rho,m))
df <- data.frame(mvrnorm(n = n, mu=rep(0,m), sigma))
return(df)
})
# Create scatterplot object the plotOutput function is expecting
output$dist.z <- renderPlot({
df <- df()
pooled.z <- unlist(df)
hist(pooled.z,prob=TRUE,breaks=50)
curve(dnorm(x, mean=0, sd=1),
col="darkblue", lwd=2, add=TRUE, yaxt="n")
})
# # Pull in description of trend
# output$desc <- renderText({
#   trend_text <- filter(trend_description, type == input$type) %>% pull(text)
#   paste(trend_text, "The index is set to 1.0 on January 1, 2004 and is calculated only for US search traffic.")
# })
}
# Create Shiny object
shinyApp(ui = ui, server = server)
##################################################################
runApp('11_6_2017/pooled z.R')
runApp('11_6_2017/pooled z.R')
runApp('11_6_2017/pooled z.R')
empricalFDR_m <- function(rho,m,B,stat){
# number of total rejection
n.f_reject <- c()
# number of false rejection
n.reject <- c()
# create correlation mareix with equal correlation
sigma <- diag(m)+matrix(rep(rho,m*m),nrow=m)-diag(rep(rho,m))
# Simulation start
for (i in 1:B) {
# create multivariate normal observations
df <- data.frame(mvrnorm(n = 200, mu=c(rep(0.5,0.1*m),rep(0,0.9*m)), sigma))
# calculate z stats
mul.z <- apply(df,2,z.test)
# number of rejections
n.reject <- sum(mul.z >= qnorm(0.95))
n.reject <-max(n.reject,1)
n.f_reject <- sum(mul.z[(0.1*m+1):m]>=qnorm(0.95))
fdr <- n.f_reject/n.reject
}
# calculate empirical mean/var of # rejections
mean.fdr <- mean(fdr)
var.fdr <- var(fdr)
if (stat=='mean'){
return(mean.fdr)
} else if (stat=='var'){
return(var.fdr)
}
}
#  mean
rho.list <- seq(0,1,by=0.05)
error.mean_m  <- sapply(rho.list, empricalFDR_m, m=100, B=5000,stat='mean')
plot(error.mean_m ~rho.list,xlab='Correlation', ylab='Empirical fdr (mean)' )
